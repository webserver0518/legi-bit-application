<!-- app/flask/templates/user_components/new_case.html -->
<div class="container-fluid">

  <div class="add-case-page">
    <form id="addCaseForm" enctype="multipart/form-data">

      <div class="accordion" id="caseAccordion">

        <!-- Section 1 – Client Details -->
        <div class="accordion-item border-0">
          <h2 class="accordion-header" id="headingClient">
            <button class="section-header w-100 text-start collapsed" type="button" data-target="#collapseClient">
              פרטי הלקוחות
            </button>
          </h2>
          <div id="collapseClient" class="accordion-collapse">

            <!-- Client Basic Details -->
            <div class="accordion-body section-content">
              <div class="form-grid">

                <div class="position-relative">
                  <input name="client_first_name" class="form-control required-field" id="client-first-name-input"
                    autocomplete="off" spellcheck="false" maxlength="30" placeholder="שם פרטי">
                  <ul id="client-name-suggestions" class="list-group position-absolute w-100"
                    style="z-index: 1000; display: none;"></ul>
                  <span class="required-indicator">*</span>
                </div>

                <div class="position-relative">
                  <input name="client_last_name" class="form-control" id="client-last-name-input" autocomplete="off"
                    autocorrect="off" spellcheck="false" maxlength="30" placeholder="שם משפחה">
                </div>

                <input name="client_id_card_number" class="form-control" autocomplete="off" autocorrect="off"
                  spellcheck="false" maxlength="9" placeholder="מספר תעודת זהות">

                <input name="client_phone" class="form-control" autocomplete="off" autocorrect="off" spellcheck="false"
                  maxlength="10" placeholder="טלפון">

              </div>
            </div>

            <!-- Client Address -->
            <div class="accordion-body section-content">
              <div class="form-grid">
                <input name="client_city" class="form-control" autocomplete="off" autocorrect="off" spellcheck="false"
                  maxlength="40" placeholder="עיר">
                <input name="client_street" class="form-control" autocomplete="off" autocorrect="off" spellcheck="false"
                  maxlength="50" placeholder="רחוב">
                <input name="client_home_number" class="form-control" autocomplete="off" autocorrect="off"
                  spellcheck="false" maxlength="3" placeholder="מספר בית">
                <input name="client_postal_code" class="form-control" autocomplete="off" autocorrect="off"
                  spellcheck="false" maxlength="7" placeholder="מיקוד">
              </div>
            </div>

            <!-- Client Additional Info -->
            <div class="accordion-body section-content">
              <div class="form-grid">
                <input type="email" name="client_email" class="form-control" autocomplete="off" autocorrect="off"
                  spellcheck="false" maxlength="100" placeholder="אימייל">

                <div class="position-relative birthdate-wrapper">
                  <input type="text" name="client_birth_date" id="client-birthdate-input" class="form-control"
                    placeholder="תאריך לידה" autocomplete="off">
                </div>

                <select id="client_role" name="client_role" class="form-select">
                  <option value="main">ראשי</option>
                  <option value="secondary">משני</option>
                </select>

                <!-- צד משפטי -->
                <select id="client_legal_role" name="client_legal_role" class="form-select">
                  <option value="prosecutor">תובע</option>
                  <option value="defendant">נתבע</option>
                </select>

              </div>
            </div>

            <div class="accordion-body section-content">
              <div class="form-grid">
                <button type="button" id="add-client-btn" class="btn btn-success">
                  ➕ הוסף לקוח
                </button>
              </div>
            </div>

            <input type="hidden" id="clients-json-input" name="clients_json" value="[]">


            <!-- Clients table -->
            <div class="accordion-body section-content">
              <div class="table-responsive">
                <table class="table table-striped table-sm align-middle text-center" id="clients-table">
                  <thead class="table-light">
                    <tr>
                      <th>שם פרטי</th>
                      <th>שם משפחה</th>
                      <th>ת"ז</th>
                      <th>טלפון</th>
                      <th>עיר</th>
                      <th>רחוב</th>
                      <th>מס' בית</th>
                      <th>מיקוד</th>
                      <th>אימייל</th>
                      <th>תאריך לידה</th>
                      <th>ראשי/משני</th>
                      <th>תובע/נתבע</th>
                      <th>פעולות</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
              <small class="text-muted">יש להוסיף לפחות לקוח ראשי אחד</small>
            </div>

          </div>
        </div>

        <!-- Section 2 – Case Details -->
        <div class="accordion-item border-0">
          <h2 class="accordion-header" id="headingCase">
            <button class="section-header w-100 text-start collapsed" type="button" data-target="#collapseCase">
              פרטי התיק
            </button>
          </h2>
          <div id="collapseCase" class="accordion-collapse">

            <div class="accordion-body section-content">
              <div class="form-grid">

                <div class="position-relative">
                  <input name="title" id="case-title-input" class="form-control required-field" autocomplete="off"
                    spellcheck="false" maxlength="40" placeholder="כותרת">
                  <span class="required-indicator">*</span>
                </div>

                <div class="position-relative">
                  <input name="responsible" id="responsible-input" class="form-control" autocomplete="off"
                    spellcheck="false" maxlength="40" placeholder="אחראי">
                  <ul id="responsible-suggestions" class="list-group position-absolute w-100" style="z-index: 1000;">
                  </ul>
                </div>

                <div class="position-relative">
                  <input name="field" id="field-input" class="form-control" autocomplete="off" maxlength="40"
                    placeholder="תחום">
                  <ul id="field-suggestions" class="list-group position-absolute w-100" style="z-index: 1000;"></ul>
                </div>

              </div>
            </div>

            <div class="accordion-body section-content">
              <div class="form-grid">

                <div class="mb-3">
                  <textarea name="facts" id="case-facts-input" rows="5" class="form-control" autocomplete="off"
                    autocorrect="off" spellcheck="false" placeholder="תיאור"></textarea>
                </div>

              </div>
            </div>

            <div class="accordion-body section-content">
              <div class="form-grid">

                <input name="against" class="form-control" autocomplete="off" autocorrect="off" spellcheck="false"
                  maxlength="40" placeholder='נגד:  שם / ח"פ / ארגון'>

                <div class="position-relative">
                  <select id="against-type" name="against_type" class="form-select">
                    <option value="נתבע">נתבע</option>
                    <option value="תובע">תובע</option>
                  </select>
                </div>



              </div>
            </div>

          </div>
        </div>

        <!-- Section 3 – File Upload -->
        <div class="accordion-item border-0">
          <h2 class="accordion-header" id="headingFiles">
            <button class="section-header w-100 text-start collapsed" type="button" data-target="#collapseFiles">
              העלאת קבצים
            </button>
          </h2>
          <div id="collapseFiles" class="accordion-collapse">
            <div class="accordion-body section-content">

              <!-- Drap & Drop -->
              <div id="drop-area">
                גרור קבצים לכאן או לחץ לבחירה
                <input type="file" id="fileElem" hidden multiple>
              </div>

              <!-- Table -->
              <table class="table table-striped table-sm mt-3 d-none" id="fileTable">
                <thead class="table-light">
                  <tr>
                    <th style="width: 30%;">שם קובץ</th>
                    <th style="width: 10%;">סוג תוכן</th>
                    <th style="width: 35%;">תיאור</th>
                    <th style="width: 15%;">שיוך ללקוח</th>
                    <th style="width: 10%;">התקדמות</th>
                    <th style="width: 5%;">פעולות</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>

            </div>
          </div>
        </div>

        <!-- Section 4 – Submit -->
        <div class="accordion-item border-0">
          <h2 class="accordion-header" id="headingSubmit">
            <button class="section-header w-100 text-start collapsed" type="button" data-target="#collapseSubmit">
              אישור וסיום
            </button>
          </h2>
          <div id="collapseSubmit" class="accordion-collapse">
            <div class="accordion-body section-content text-center">
              <p class="mb-4">
                לחץ על <strong>פתח תיק</strong> כדי לשמור את הנתונים ולהעלות את הקבצים.
              </p>
              <button id="submitCaseBtn" class="btn btn-success btn-lg w-100" type="submit">
                פתח תיק
              </button>
            </div>
          </div>
        </div>

      </div><!-- /accordion -->

    </form>
  </div>

</div>